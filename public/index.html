<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cricket Live Score (Realtime)</title>
  <style>
    body { font-family: Arial; background: #e8f5e9; text-align: center; }
    input, button { margin: 5px; padding: 8px; }
    .score { font-size: 32px; font-weight: bold; color: #2e7d32; }
  </style>
</head>
<body>

  <h1>üèè Cricket Live Score</h1>

  <div id="setup">
    <input id="matchId" placeholder="Match ID (e.g. INDvsAUS)">
    <input id="teamA" placeholder="Team A">
    <input id="teamB" placeholder="Team B">
    <button onclick="loadMatch()">Load Match</button>
  </div>

  <div id="scoreboard" style="display:none;">
    <h2 id="matchTitle"></h2>
    <p id="teamNames"></p>
    <div class="score" id="scoreDisplay">0 / 0</div>
    <p id="overDisplay">Overs: 0.0</p>
    <div>
      <button onclick="addRun(1)">+1</button>
      <button onclick="addRun(4)">+4</button>
      <button onclick="addRun(6)">+6</button>
      <button onclick="addWicket()">Wicket</button>
      <button onclick="addBall()">Next Ball</button>
      <button onclick="reset()">Reset</button>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let matchId, teamA, teamB;
    let runs = 0, wickets = 0, balls = 0;

    async function loadMatch() {
      matchId = document.getElementById("matchId").value.trim();
      teamA = document.getElementById("teamA").value.trim();
      teamB = document.getElementById("teamB").value.trim();

      if (!matchId || !teamA || !teamB) return alert("Enter all fields!");

      document.getElementById("setup").style.display = "none";
      document.getElementById("scoreboard").style.display = "block";
      document.getElementById("matchTitle").innerText = `Match: ${matchId}`;
      document.getElementById("teamNames").innerText = `${teamA} vs ${teamB}`;

      socket.emit("subscribe", matchId);

      const res = await fetch(`/api/match/${matchId}`);
      if (res.ok) {
        const data = await res.json();
        runs = data.runs || 0;
        wickets = data.wickets || 0;
        balls = data.balls || 0;
      } else {
        await saveMatch();
      }
      updateDisplay();
    }

    socket.on("scoreUpdate", (data) => {
      if (data.id === matchId) {
        runs = data.runs;
        wickets = data.wickets;
        balls = data.balls;
        document.getElementById("teamNames").innerText = `${data.teamA} vs ${data.teamB}`;
        updateDisplay(false);
      }
    });

    async function saveMatch() {
      await fetch(`/api/match/${matchId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ runs, wickets, balls, teamA, teamB })
      });
    }

    function updateDisplay(save = true) {
      document.getElementById("scoreDisplay").innerText = `${runs} / ${wickets}`;
      document.getElementById("overDisplay").innerText = `Overs: ${Math.floor(balls / 6)}.${balls % 6}`;
      if (save) saveMatch();
    }

    function addRun(n) { runs += n; balls++; updateDisplay(); }
    function addWicket() { wickets++; balls++; updateDisplay(); }
    function addBall() { balls++; updateDisplay(); }
    function reset() { runs = 0; wickets = 0; balls = 0; updateDisplay(); }
  </script>
</body>
</html>
